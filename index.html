<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ARãƒ¢ãƒ‡ãƒ«ä½ç½®è¡¨ç¤ºï¼ˆLeafletç‰ˆï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-o9N1jZa0f4bN1Qh6k4f8p3KXhYqgR6Yf9v+v+g1w6Xk="
    crossorigin=""
  />
  <style>
    body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; background:#f7f9fc; color:#333; }
    header { padding:12px; text-align:center; background:#fff; box-shadow:0 1px 3px rgba(0,0,0,0.06); }
    #map { height: 60vh; width: 100%; margin-top:10px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.15); }
    .controls { padding:12px; display:flex; flex-direction:column; gap:8px; align-items:center; }
    .coords-box { background:#fff; padding:10px 12px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.08); }
    .btn { padding:8px 12px; border-radius:8px; border:1px solid #ddd; background:#fff; cursor:pointer; text-decoration:none; color:#333; }
    .btn:active { transform:translateY(1px); }
    footer { padding:10px; text-align:center; color:#666; font-size:13px; }
  </style>
  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-o2bM7kC6vXgI0aS1cQqZ4CqY4s6Q0z2R8qz9g+v9wY8="
    crossorigin=""
  ></script>
</head>
<body>
  <header>
    <h2>ARãƒ¢ãƒ‡ãƒ«ä½ç½®ã¨ç¾åœ¨åœ°</h2>
    <div style="font-size:14px; color:#444;">ãƒ¢ãƒ‡ãƒ«ä½ç½®ï¼š36.50516184328213, 138.11215639377093</div>
  </header>

  <div id="map"></div>

  <div class="controls">
    <div class="coords-box">
      ğŸ“ è·é›¢ï¼š<strong id="distanceText">ç¾åœ¨åœ°å–å¾—ä¸­â€¦</strong><br>
      â€»ä½ç½®æƒ…å ±ã®è¨±å¯ã‚’æ±‚ã‚ã‚‰ã‚ŒãŸã‚‰ã€Œè¨±å¯ã€ã—ã¦ãã ã•ã„
    </div>

    <div style="display:flex; gap:8px; margin-top:8px;">
      <a class="btn" href="model.usdz" rel="ar">ARã§è¡¨ç¤ºï¼ˆQuick Lookï¼‰</a>
      <a class="btn" id="openMapBtn" target="_blank" rel="noopener">OpenStreetMapã§é–‹ã</a>
    </div>
  </div>

  <footer>Leaflet + OpenStreetMap ä½¿ç”¨ â€” å®Œå…¨ç„¡æ–™ã€APIã‚­ãƒ¼ä¸è¦</footer>

  <script>
    // ãƒ¢ãƒ‡ãƒ«ä½ç½®
    const modelLat = 36.50516184328213;
    const modelLng = 138.11215639377093;
    const modelLatLng = L.latLng(modelLat, modelLng);

    // ãƒãƒƒãƒ—åˆæœŸåŒ–
    const map = L.map('map').setView(modelLatLng, 16);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    // ãƒ¢ãƒ‡ãƒ«ãƒãƒ¼ã‚«ãƒ¼
    const modelMarker = L.marker(modelLatLng).addTo(map);
    modelMarker.bindPopup('<strong>ãƒ¢ãƒ‡ãƒ«ä½ç½®</strong><br>36.50516184328213, 138.11215639377093');

    // è·é›¢è¡¨ç¤º
    const distanceEl = document.getElementById('distanceText');

    // OpenStreetMapã§é–‹ããƒªãƒ³ã‚¯
    const openMapBtn = document.getElementById('openMapBtn');
    openMapBtn.href = `https://www.openstreetmap.org/?mlat=${modelLat}&mlon=${modelLng}#map=18/${modelLat}/${modelLng}`;

    // ç¾åœ¨åœ°å–å¾—ãƒ»ãƒãƒ¼ã‚«ãƒ¼è¿½åŠ ãƒ»è·é›¢è¨ˆç®—
    function formatDistance(m) {
      if (m === null) return 'å–å¾—ã§ãã¾ã›ã‚“';
      return m < 1000 ? `${m.toFixed(1)} m` : `${(m/1000).toFixed(2)} km`;
    }

    function placeUserMarker(pos) {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;
      const userLatLng = L.latLng(lat, lng);

      const userMarker = L.marker(userLatLng, { title: 'ã‚ãªãŸã®ç¾åœ¨åœ°' }).addTo(map);
      userMarker.bindPopup('<strong>ã‚ãªãŸã®ç¾åœ¨åœ°</strong>').openPopup();

      const distanceMeters = userLatLng.distanceTo(modelLatLng);
      distanceEl.textContent = formatDistance(distanceMeters);

      const bounds = L.latLngBounds([userLatLng, modelLatLng]);
      map.fitBounds(bounds, { padding: [60, 60] });
    }

    function geoError(err) {
      console.warn('ä½ç½®æƒ…å ±ã‚¨ãƒ©ãƒ¼', err);
      distanceEl.textContent = 'ç¾åœ¨åœ°ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ';
    }

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(placeUserMarker, geoError, {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 0
      });
    } else {
      distanceEl.textContent = 'ä½ç½®æƒ…å ±ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“';
    }
  </script>
</body>
</html>
