<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>安全版ARモデル表示</title>
  <!-- A-Frame本体 -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <!-- AR.js GPS -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  <!-- Model Viewer (iPhone AR Quick Look用) -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body style="margin:0; overflow:hidden;">

<script>
document.addEventListener('DOMContentLoaded', () => {
  const isiPhone = /iPhone|iPad|iPod/i.test(navigator.userAgent);

  if (isiPhone) {
    // iPhone用：Quick Look AR
    const modelViewer = document.createElement('model-viewer');
    modelViewer.setAttribute('src', 'model.glb');      // GLBも指定
    modelViewer.setAttribute('ios-src', 'model.usdz'); // USDZ必須
    modelViewer.setAttribute('ar', '');
    modelViewer.setAttribute('ar-modes', 'quick-look');
    modelViewer.setAttribute('camera-controls', '');
    modelViewer.setAttribute('auto-rotate', '');
    modelViewer.style.width = '100vw';
    modelViewer.style.height = '100vh';
    document.body.appendChild(modelViewer);

  } else {
    // Android / PC用：A-Frame
    const scene = document.createElement('a-scene');
    scene.setAttribute('embedded', '');
    scene.setAttribute('vr-mode-ui', 'enabled: false');
    scene.setAttribute('renderer', 'logarithmicDepthBuffer: true;');
    scene.setAttribute('arjs', 'sourceType: webcam; trackingMethod: best; debugUIEnabled: false;');

    const model = document.createElement('a-entity');
    model.setAttribute('gltf-model', './model.glb');
    model.setAttribute('scale', '1 1 1');
    model.setAttribute('rotation', '0 0 0');
    model.setAttribute('position', '0 0 -2'); // 初期位置は画面中央

    // GPSが取得できたら座標に移動
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        () => {
          model.setAttribute('gps-entity-place', 'latitude:36.3019; longitude:138.0644;');
        },
        () => {
          // GPS取得失敗時はそのまま中央表示
        },
        { enableHighAccuracy: true, timeout: 5000 }
      );
    }

    scene.appendChild(model);

    const camera = document.createElement('a-camera');
    camera.setAttribute('gps-camera', '');
    camera.setAttribute('rotation-reader', '');
    scene.appendChild(camera);

    document.body.appendChild(scene);
  }
});
</script>

</body>
</html>


