<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>ç¾åœ¨åœ°ã¨ãƒ¢ãƒ‡ãƒ«ä½ç½® (Leaflet + OSM)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-o9N1jZa0f4bN1Qh6k4f8p3KXhYqgR6Yf9v+v+g1w6Xk="
    crossorigin=""
  />
  <style>
    body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; }
    header { padding:12px; text-align:center; background:#f7f9fc; box-shadow:0 1px 3px rgba(0,0,0,0.06); }
    #map { height: 60vh; width: 100%; }
    .controls { padding:12px; display:flex; flex-direction:column; gap:8px; align-items:center; }
    .coords-box { background:#fff; padding:10px 12px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.08); }
    .btn { padding:8px 12px; border-radius:8px; border:1px solid #ddd; background:#fff; cursor:pointer; }
    .btn:active { transform:translateY(1px); }
    footer { padding:10px; text-align:center; color:#666; font-size:13px; }
    @media (min-width:640px) { .layout { max-width:900px; margin:0 auto; } }
  </style>
  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-o2bM7kC6vXgI0aS1cQqZ4CqY4s6Q0z2R8qz9g+v9wY8="
    crossorigin=""
  ></script>
</head>
<body>
  <header class="layout">
    <h2>ARãƒ¢ãƒ‡ãƒ«ä½ç½®ã¨ç¾åœ¨åœ°ï¼ˆLeafletï¼‰</h2>
    <div style="font-size:14px; color:#444;">ãƒ¢ãƒ‡ãƒ«ä½ç½®ï¼š36.50516184328213, 138.11215639377093</div>
  </header>

  <div class="layout">
    <div id="map"></div>

    <div class="controls" style="margin-top:12px;">
      <div class="coords-box">
        <div>ğŸ“ è·é›¢ï¼š <strong id="distanceText">ç¾åœ¨åœ°å–å¾—ä¸­â€¦</strong></div>
        <div style="font-size:13px; color:#666; margin-top:6px;">â€»ä½ç½®æƒ…å ±ã®è¨±å¯ã‚’æ±‚ã‚ã‚‰ã‚ŒãŸã‚‰ã€Œè¨±å¯ã€ã—ã¦ãã ã•ã„</div>
      </div>

      <div style="display:flex; gap:8px; margin-top:8px;">
        <!-- Quick Lookã‚’é–‹ããƒªãƒ³ã‚¯ï¼ˆiPhoneã§model.usdzãŒã‚ã‚‹å ´åˆã«å‹•ä½œï¼‰ -->
        <a class="btn" href="model.usdz" rel="ar">ARã§è¡¨ç¤ºï¼ˆQuick Lookï¼‰</a>
        <!-- Google Mapsã§ãƒ¢ãƒ‡ãƒ«ä½ç½®ã‚’é–‹ãï¼ˆåˆ¥ã‚¿ãƒ–ï¼‰ -->
        <a class="btn" id="openMapBtn" target="_blank" rel="noopener">åœ°å›³ã§é–‹ã</a>
      </div>
    </div>
  </div>

  <footer>
    Leaflet + OpenStreetMap ã‚’ä½¿ç”¨ â€” APIã‚­ãƒ¼ä¸è¦ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ä½ç½®æƒ…å ±ã‚’ä½¿ã„ã¾ã™ã€‚
  </footer>

  <script>
    // ãƒ¢ãƒ‡ãƒ«ä½ç½®ï¼ˆå›ºå®šï¼‰
    const modelLat = 36.50516184328213;
    const modelLng = 138.11215639377093;
    const modelLatLng = L.latLng(modelLat, modelLng);

    // åˆæœŸãƒãƒƒãƒ—ï¼ˆä¸­å¿ƒã¯ãƒ¢ãƒ‡ãƒ«ä½ç½®ï¼‰
    const map = L.map('map', { zoomControl: true }).setView([modelLat, modelLng], 16);

    // OpenStreetMap ã‚¿ã‚¤ãƒ«
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    // ãƒ¢ãƒ‡ãƒ«ã®ãƒãƒ¼ã‚«ãƒ¼ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ©ãƒ™ãƒ«é¢¨ï¼‰
    const modelMarker = L.marker([modelLat, modelLng]).addTo(map);
    modelMarker.bindPopup('<strong>ãƒ¢ãƒ‡ãƒ«ä½ç½®</strong><br>36.50516184328213, 138.11215639377093');

    // åˆæœŸã§ãƒ¢ãƒ‡ãƒ«ä½ç½®ã‚’ä¸­å¿ƒã«ã™ã‚‹
    map.setView(modelLatLng, 16);

    // è·é›¢è¡¨ç¤ºç”¨è¦ç´ 
    const distanceEl = document.getElementById('distanceText');

    // Google Mapsã§ãƒ¢ãƒ‡ãƒ«ä½ç½®ã‚’é–‹ããƒœã‚¿ãƒ³
    const openMapBtn = document.getElementById('openMapBtn');
    openMapBtn.href = `https://www.google.com/maps?q=${modelLat},${modelLng}&z=18`;

    // è·é›¢è¨ˆç®—ï¼ˆLeaflet ã® distanceTo ã‚’åˆ©ç”¨ï¼‰
    function formatDistance(m) {
      if (m === null) return 'å–å¾—ã§ãã¾ã›ã‚“';
      if (m < 1000) return `${m.toFixed(1)} m`;
      return `${(m / 1000).toFixed(2)} km`;
    }

    // ç¾åœ¨åœ°ã‚’å–å¾—ã—ã¦ãƒãƒ¼ã‚«ãƒ¼ã‚’ç½®ãã€è·é›¢ã‚’è¨ˆç®—
    function placeUserMarker(position) {
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;
      const userLatLng = L.latLng(lat, lng);

      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ã‚«ãƒ¼ï¼ˆé’ï¼‰
      const userMarker = L.marker(userLatLng, { title: 'ã‚ãªãŸã®ç¾åœ¨åœ°' }).addTo(map);
      userMarker.bindPopup('<strong>ã‚ãªãŸã®ç¾åœ¨åœ°</strong>').openPopup();

      // è·é›¢ã‚’è¨ˆç®—
      const distanceMeters = userLatLng.distanceTo(modelLatLng); // meters
      distanceEl.textContent = formatDistance(distanceMeters);

      // ãƒãƒƒãƒ—è¡¨ç¤ºç¯„å›²ã‚’2ç‚¹ã‚’å«ã‚€ã‚ˆã†ã«èª¿æ•´
      const bounds = L.latLngBounds([userLatLng, modelLatLng]);
      map.fitBounds(bounds, { padding: [60, 60] });
    }

    function handleGeolocationError(err) {
      console.warn('Geolocation error', err);
      distanceEl.textContent = 'ç¾åœ¨åœ°ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ';
      // ãƒãƒƒãƒ—ã¯ãƒ¢ãƒ‡ãƒ«ä½ç½®ã®ã¾ã¾ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ã‚«ãƒ¼ãªã—ï¼‰
    }

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(placeUserMarker, handleGeolocationError, {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 0
      });
    } else {
      distanceEl.textContent = 'ä½ç½®æƒ…å ±ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“';
    }

    // ã‚ªãƒ—ã‚·ãƒ§ãƒ³: ä½ç½®ãŒå‹•ããŸã³ã«æ›´æ–°ã—ãŸã„å ´åˆã¯ watchPosition ã‚’ä½¿ã†ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼‰
    /*
    if (navigator.geolocation) {
      navigator.geolocation.watchPosition((pos) => {
        // æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæ—¢å­˜ãƒãƒ¼ã‚«ãƒ¼ã‚’æ›´æ–°ã™ã‚‹ç­‰ï¼‰
      }, handleGeolocationError, { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 });
    }
    */
  </script>
</body>
</html>
